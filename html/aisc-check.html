<!DOCTYPE html>
<html>

	<!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<head>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
	<script src="https://api.skyciv.com/dist/v3/javascript/skyciv.js"></script>
	<link rel="stylesheet" href="https://semantic-ui.com/dist/semantic.css" />
	
	<style>
		#section-name {
			display: initial;
		}
	</style>


	<script> 
	

	jQuery(document).ready(function () {

		var section_lib = ["W14x808", "W18x192", "W18x211", "W18x234", "W18x258", "W18x283", "W18x311", "W24x408", "W24x492", "W27x448", "W30x477", "W36x230", "W36x245", "W36x260", "W36x280", "W36x300", "W36x328", "W36x359", "W36x393", "W36x439", "W36x527", "W36x650", "W36x798", "W36x848", "W40x174", "W40x321", "W40x466", "W4x13", "W5x16", "W5x19", "W6x8.5", "W6x9", "W6x12", "W6x15", "W6x16", "W6x20", "W6x25", "W8x10", "W8x13", "W8x15", "W8x18", "W8x21", "W8x24", "W8x28", "W8x31", "W8x35", "W8x40", "W8x48", "W8x58", "W8x67", "W10x12", "W10x15", "W10x17", "W10x19", "W10x22", "W10x26", "W10x30", "W10x33", "W10x39", "W10x45", "W10x49", "W10x54", "W10x60", "W10x68", "W10x77", "W10x88", "W10x100", "W10x112", "W12x14", "W12x16", "W12x19", "W12x22", "W12x26", "W12x30", "W12x35", "W12x40", "W12x45", "W12x50", "W12x53", "W12x58", "W12x65", "W12x72", "W12x79", "W12x87", "W12x96", "W12x106", "W12x120", "W12x136", "W12x152", "W12x170", "W12x190", "W12x210", "W12x230", "W12x252", "W12x279", "W12x305", "W12x336", "W14x22", "W14x26", "W14x30", "W14x34", "W14x38", "W14x43", "W14x48", "W14x53", "W14x61", "W14x68", "W14x74", "W14x82", "W14x90", "W14x99", "W14x109", "W14x120", "W14x132", "W14x145", "W14x159", "W14x176", "W14x193", "W14x211", "W14x233", "W14x257", "W14x283", "W14x311", "W14x342", "W14x370", "W14x398", "W14x426", "W14x455", "W14x500", "W14x550", "W14x605", "W14x665", "W14x730", "W16x26", "W16x31", "W16x36", "W16x40", "W16x45", "W16x50", "W16x57", "W16x67", "W16x77", "W16x89", "W16x100", "W18x35", "W18x40", "W18x46", "W18x50", "W18x55", "W18x60", "W18x65", "W18x71", "W18x76", "W18x86", "W18x97", "W18x106", "W18x119", "W18x130", "W18x143", "W18x158", "W18x175", "W21x44", "W21x48", "W21x50", "W21x55", "W21x57", "W21x62", "W21x68", "W21x73", "W21x83", "W21x93", "W21x101", "W21x111", "W21x122", "W21x132", "W21x147", "W21x166", "W21x182", "W21x201", "W24x55", "W24x62", "W24x68", "W24x76", "W24x84", "W24x94", "W24x103", "W24x104", "W24x117", "W24x131", "W24x146", "W24x162", "W24x176", "W24x192", "W24x207", "W24x229", "W24x250", "W24x279", "W24x306", "W24x335", "W24x370", "W27x84", "W27x94", "W27x102", "W27x114", "W27x129", "W27x146", "W27x161", "W27x178", "W27x194", "W27x217", "W27x235", "W27x258", "W27x281", "W27x307", "W27x336", "W27x368", "W27x539", "W30x90", "W30x99", "W30x108", "W30x116", "W30x124", "W30x132", "W30x148", "W30x173", "W30x191", "W30x211", "W30x235", "W30x261", "W30x292", "W30x326", "W30x357", "W30x391", "W33x118", "W33x130", "W33x141", "W33x152", "W33x169", "W33x201", "W33x221", "W33x241", "W33x263", "W33x291", "W33x318", "W33x354", "W33x387", "W36x135", "W36x150", "W36x160", "W36x170", "W36x182", "W36x194", "W36x210", "W36x231", "W36x232", "W36x247", "W36x256", "W36x262", "W36x282", "W36x302", "W36x330", "W36x361", "W36x395", "W36x441", "W36x487", "W36x529", "W36x652", "W40x149", "W40x167", "W40x183", "W40x199", "W40x211", "W40x215", "W40x235", "W40x249", "W40x264", "W40x277", "W40x278", "W40x294", "W40x297", "W40x327", "W40x331", "W40x362", "W40x372", "W40x392", "W40x397", "W40x431", "W40x503", "W40x593", "W44x230", "W44x262", "W44x290", "W44x335"];
		var new_arr = [];
		for (var n = 0; n < section_lib.length; n++) {
			new_arr.push({ title: section_lib[n] })
		}
		console.log(new_arr)
		jQuery('#section-name').search({ source: new_arr });


		jQuery("#beam-type .button").click(function() {
			jQuery("#beam-type .button").removeClass("active");
			jQuery(this).addClass("active");
		});

		

		jQuery("#run-api").click(function() {

			jQuery("#status-bar").html("Running...");

			var length = jQuery("#beam-length").val();
			var beam_type = "Cantilever";
			
			$("#beam-type .button").each(function (index) {
				if (jQuery(this).hasClass("active")) beam_type = jQuery(this).html();
			});

			var section_name = jQuery('#section-name').search("get value");

			var supports_obj = {};
			if (beam_type == "Cantilever") {
				supports_obj = {
					"1": {
						"node": 1,
						"restraint_code": "FFFFFF"
					}
				}
			} else {
				supports_obj = {
					"1": {
						"node": 1,
						"restraint_code": "FFFFFR"
					},
					"2": {
						"node": 2,
						"restraint_code": "FFFFFR"
					},					
				}
			}

			var model_data = {
				"settings": {
					"units": "imperial",
				},
				"nodes": {
					"1": {
						"x": 0,
						"y": 0,
						"z": 0
					},
					"2": {
						"x": length,
						"y": 0,
						"z": 0
					}
				},
				"members": {
					"1": {
						"node_A": 1,
						"node_B": 2,
						"section_id": 1
					}
				},
				"sections": {
					"1": {
						"load_section": [
							"American",
							"AISC",
							"W shapes",
							"W14x808"
						],
						"material_id": 1
					}
				},
				"materials": {
					"1": {
						"name": "Structural Steel",
						"density": 490,
						"elasticity_modulus": 29000,
						"poissons_ratio": 0.27,
						"ultimate_strength": 59,
						"yield_strength": 38
					},
				},
				"supports": supports_obj,
				"point_loads": {
					"1": {
						"type": "n",
						"node": 2,
						"x_mag": 0,
						"y_mag": -5,
						"z_mag": 0,
						"load_group": "Live_PL"
					},
					"2": {
						"type": "M",
						"member": 1,
						"position": 50,
						"x_mag": 0,
						"y_mag": -2.5,
						"z_mag": 0,
						"load_group": "Live_PL"
					}
				},
				"distributed_loads": {
					"1": {
						"member": 1,
						"x_mag_A": 0,
						"y_mag_A": -1,
						"z_mag_A": 0,
						"x_mag_B": 0,
						"y_mag_B": -1,
						"z_mag_B": 0,
						"position_A": 0,
						"position_B": 100,
						"load_group": "Live_DL",
						"axes": "global"
					}
				},
				"self_weight": {
					"1": {
						"LG": "SW1",
						"x": 0,
						"y": -1,
						"z": 0
					}
				}
			};

			var api_object = {
				auth: {
					"username": "sam@skyciv.com",
					"key": "sZFl0x6w7iq53bub7sFzhpZuDVMiPJEyVNNaXN6Kb5DfuJl5RIuUTnzK6HwKx4k6"
				},
				functions: [
					{
						'function': 'S3D.session.start', // starting a session
						'arguments': {}
					},
					{
						'function': 'S3D.model.set', // Setting the model
						'arguments': {
							's3d_model': model_data
						}
					},
					{
						"function": "S3D.model.takeScreenshot",
						"arguments": {
							"views": [
								"front"
							],
							"is_renderer": false,
							"visibility_settings": { //wireframe only
								"show_nodes": true,
								"show_loads": true,
								"show_plates": true,
								"projection": "perspective" // "orthographic"
							}
						}
					},
					{
						'function': "S3D.model.solve", // Running an analysis
						'arguments': {
							analysis_type: 'nonlinear', //linear, nonlinear, buckling
							repair_model: true
						},
					},
					{
						'function': "S3D.results.fetchMemberResult",
						'arguments': {
							"member_id": 1, 
							"LC": [], 
							"res_key": "bmd_z", //sfd_y
							"type": "image" 
						}
					},
					{
						"function": "S3D.member_design.check",
						"arguments": {
							"design_code": "AISC_360-16_LRFD"
						}
					}
				]
			}

			console.log("--- Input ---");
			console.log(api_object);

			//can use skyciv resource:
			skyciv.request(api_object, function (res) {
				console.log("--- Response ---");
				console.log(res);
				var response = res.response;
				var all_funcs = res.functions;

				jQuery("#status-bar").html(response.msg);

				if (all_funcs[2].status == 0) {
					var fbd_img = all_funcs[2].data.front; //S3D.model.takescreenshot
					jQuery("#fbd_output").html("<img src='" + fbd_img + "' style='width:100%;'>");
				}

				if (all_funcs[4].status == 0) {
					var bmd_img = all_funcs[4].data[0]; //S3D.results.fetchMemberResult
					jQuery("#bmd_output").html("<img src='" + bmd_img + "' style='width:100%;'>");
				}

				if (all_funcs[5].status == 0) {
					var aisc_results = all_funcs[5].data; //S3D.results.fetchMemberResult
					jQuery("#bmd_output").html("<img src='" + bmd_img + "' style='width:100%;'>");
				}

			})
		})

	});
	
	</script>
</head>

<body style="padding:20px;">
	<h2>Basic AISC Check</h2>

	<div class="ui right labeled input">
		<input type="text" placeholder="Enter Beam Length..." id="beam-length">
		<div class="ui basic label">ft</div>
	</div>

	<div class="ui basic buttons" id="beam-type">
		<div class="ui button active">Cantilever</div>
		<div class="ui button">Simply Supported</div>
	</div>

	<div class="ui search" id="section-name">
		<div class="ui icon input">
			<input class="prompt" type="text" placeholder="Section Search..." value="W14x808">
			<i class="search icon"></i>
		</div>
		<div class="results"></div>
	</div>


	<button class="ui button primary" id="run-api">Run AISC Check</button>

	<div style="display: block; margin-top: 8px; padding: 1%;  border: 1px solid #666;  background-color: #efefef;" id="status-bar">Click button to Run</div><br>
	<div id="output">

		<div class="ui grid container stackable">
			<div class="six wide column" id="fbd_output"></div>
			<div class="six wide column" id="bmd_output"></div>
			<div class="six wide column" id="other_output"></div>
		</div>

	</div>

</body>

</html>